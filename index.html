<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>íë§ˆì¼“ CRM ì„¸ê·¸ë¨¼íŠ¸ ëŒ€ì‹œë³´ë“œ</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/papaparse@5/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <div id="root"></div>

  <script type="module">
    // ========================================
    // ğŸ“¥ ëª¨ë“  ëª¨ë“ˆ import
    // ========================================

    import { PREDEFINED_SEGMENTS, NOTIFLY_CONFIG, CUSTOM_SEGMENT_TEMPLATE, BATCH_SIZES } from './src/config/constants.js';
    import { supabase } from './src/config/supabase.js';
    import { fetchAllUsers, fetchAllOrders, fetchAllCoupons, fetchDatabaseStats, fetchCustomSegments, saveCustomSegment, deleteCustomSegment } from './src/api/database.js';
    import { getNotiflyToken } from './src/api/notifly.js';
    import { analyzeSegments } from './src/services/segmentService.js';
    import { sendCampaignBatch, sendTestCampaign } from './src/services/campaignService.js';
    import { updateUserPropertiesBatch } from './src/services/propertyService.js';
    import { logger } from './src/utils/logger.js';
    import { exportToCSV } from './src/utils/csvExporter.js';

    const { useState, useEffect } = React;

    // ========================================
    // ğŸ¨ React ì»´í¬ë„ŒíŠ¸
    // ========================================

    const SegmentCard = ({ name, users, info, onDownloadCSV, onUpdateProperties, onSendCampaign, onSendTest, propertyName, propertyValue, campaignId, testUserIds, onPropertyNameChange, onPropertyValueChange, onCampaignIdChange, onTestUserIdsChange, isCustom, onDelete }) => {
      if (!users || users.length === 0) return null;

      const pushUsers = users.filter(u => u.í‘¸ì‹œê°€ëŠ¥).length;
      const smsUsers = users.filter(u => u.SMSê°€ëŠ¥).length;
      const alimtalkUsers = users.filter(u => u.ì•Œë¦¼í†¡ê°€ëŠ¥).length;

      return (
        <div className="bg-white rounded-lg shadow p-4 hover:shadow-lg transition">
          <div className="mb-3">
            <div className="flex items-center justify-between">
              <h3 className="font-bold text-lg">
                {name} <span className="text-orange-600">({users.length.toLocaleString()}ëª…)</span>
              </h3>
              {isCustom && (
                <button
                  onClick={() => onDelete(name)}
                  className="text-red-500 text-sm hover:text-red-700"
                >
                  ğŸ—‘ï¸ ì‚­ì œ
                </button>
              )}
            </div>
            {info && (
              <div className="text-xs text-gray-600 mt-1">
                <div className="font-medium">ğŸ“‹ {info.conditions}</div>
                {info.description && <div className="text-gray-500 mt-0.5">{info.description}</div>}
              </div>
            )}
            <div className="text-xs text-gray-500 mt-1">
              ğŸ“± í‘¸ì‹œ: {pushUsers.toLocaleString()}ëª… | ğŸ’¬ SMS: {smsUsers.toLocaleString()}ëª… | ğŸ’Œ ì•Œë¦¼í†¡: {alimtalkUsers.toLocaleString()}ëª…
            </div>
          </div>

          {/* CSV ë‹¤ìš´ë¡œë“œ */}
          <div className="mb-3">
            <button
              onClick={() => onDownloadCSV(name)}
              className="w-full bg-green-500 text-white py-2 rounded hover:bg-green-600 text-sm transition font-medium"
            >
              ğŸ“¥ CSV ë‹¤ìš´ë¡œë“œ
            </button>
          </div>

          {/* ì†ì„± ì—…ë°ì´íŠ¸ */}
          <div className="mb-3 p-3 bg-blue-50 rounded-lg border border-blue-200">
            <div className="text-xs font-bold text-blue-900 mb-2">ğŸ·ï¸ ì†ì„± ì—…ë°ì´íŠ¸</div>
            <div className="grid grid-cols-12 gap-2">
              <input
                type="text"
                placeholder="ì†ì„±ëª… (ì˜ˆ: ë§ˆì¼€íŒ…_ì„¸ê·¸ë¨¼íŠ¸)"
                value={propertyName || ''}
                onChange={(e) => onPropertyNameChange(name, e.target.value)}
                className="col-span-5 border rounded px-2 py-1.5 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
              <input
                type="text"
                placeholder="ì†ì„±ê°’ (ì˜ˆ: ê³ ê°€ì¹˜_íœ´ë©´)"
                value={propertyValue || ''}
                onChange={(e) => onPropertyValueChange(name, e.target.value)}
                className="col-span-5 border rounded px-2 py-1.5 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
              <button
                onClick={() => onUpdateProperties(name)}
                disabled={!propertyName || !propertyValue}
                className="col-span-2 bg-blue-500 text-white py-1.5 rounded hover:bg-blue-600 disabled:bg-gray-300 text-xs transition font-medium"
              >
                âœ… ì—…ë°ì´íŠ¸
              </button>
            </div>
          </div>

          {/* ìº í˜ì¸ ë°œì†¡ */}
          <div className="p-3 bg-purple-50 rounded-lg border border-purple-200">
            <div className="text-xs font-bold text-purple-900 mb-2">ğŸ“¨ ìº í˜ì¸ ë°œì†¡</div>
            
            <div className="mb-2">
              <input
                type="text"
                placeholder="ìº í˜ì¸ ID (ì˜ˆ: RzpI2K)"
                value={campaignId || ''}
                onChange={(e) => onCampaignIdChange(name, e.target.value)}
                className="w-full border rounded px-2 py-1.5 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500"
              />
            </div>

            <div className="grid grid-cols-3 gap-2 mb-2">
              <input
                type="text"
                placeholder="í…ŒìŠ¤íŠ¸ User ID (ì‰¼í‘œêµ¬ë¶„)"
                value={testUserIds || ''}
                onChange={(e) => onTestUserIdsChange(name, e.target.value)}
                className="col-span-2 border rounded px-2 py-1 text-xs focus:outline-none focus:ring-2 focus:ring-yellow-500"
                title="ì˜ˆ: 13,381,489"
              />
              <button
                onClick={() => onSendTest(name)}
                disabled={!campaignId || !testUserIds}
                className="bg-yellow-500 text-white py-1 rounded hover:bg-yellow-600 disabled:bg-gray-300 text-xs transition font-medium"
              >
                ğŸ§ª í…ŒìŠ¤íŠ¸
              </button>
            </div>

            <button
              onClick={() => onSendCampaign(name)}
              disabled={!campaignId}
              className="w-full bg-purple-600 text-white py-2 rounded hover:bg-purple-700 disabled:bg-gray-300 text-sm transition font-bold"
            >
              ğŸ“¨ ì „ì²´ ë°œì†¡ ({pushUsers.toLocaleString()}ëª…)
            </button>
          </div>
        </div>
      );
    };

    const Dashboard = () => {
      const [activeTab, setActiveTab] = useState('predefined');
      const [activeCategory, setActiveCategory] = useState('íœ´ë©´');
      const [segments, setSegments] = useState(null);
      const [customSegs, setCustomSegs] = useState([]);
      const [loading, setLoading] = useState(false);
      const [dbStats, setDbStats] = useState({ users: 0, orders: 0, coupons: 0 });
      const [campaignIds, setCampaignIds] = useState({});
      const [testUserIds, setTestUserIds] = useState({});
      const [propertyNames, setPropertyNames] = useState({});
      const [propertyValues, setPropertyValues] = useState({});
      const [newSegment, setNewSegment] = useState(JSON.parse(JSON.stringify(CUSTOM_SEGMENT_TEMPLATE)));
      const [allUsers, setAllUsers] = useState([]);

      // DB í†µê³„ ë¡œë“œ
      useEffect(() => {
        const loadStats = async () => {
          try {
            const stats = await fetchDatabaseStats();
            setDbStats(stats);
            logger.info(`DB í†µê³„ ë¡œë“œ ì™„ë£Œ: Users ${stats.users}ëª…`);
          } catch (error) {
            logger.error(`í†µê³„ ë¡œë“œ ì‹¤íŒ¨: ${error.message}`);
          }
        };
        
        const loadCustomSegs = async () => {
          try {
            const data = await fetchCustomSegments();
            setCustomSegs(data || []);
            logger.info(`ì»¤ìŠ¤í…€ ì„¸ê·¸ë¨¼íŠ¸ ${data?.length || 0}ê°œ ë¡œë“œ`);
          } catch (error) {
            logger.error(`ì»¤ìŠ¤í…€ ì„¸ê·¸ë¨¼íŠ¸ ë¡œë“œ ì‹¤íŒ¨: ${error.message}`);
          }
        };

        logger.info('ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” ì¤‘...');
        loadStats();
        loadCustomSegs();
      }, []);

      const analyzeAndClassify = async () => {
        setLoading(true);
        try {
          const result = await analyzeSegments((progress) => {
            logger.info(`ë¶„ì„ ì§„í–‰ë¥ : ${progress}%`);
          });
          setSegments(result.segments);
          setCustomSegs(result.customSegs);
          
          // allUsers ì €ì¥
          const users = await fetchAllUsers();
          setAllUsers(users);
        } catch (error) {
          logger.error(`ë¶„ì„ ì‹¤íŒ¨: ${error.message}`);
        } finally {
          setLoading(false);
        }
      };

      const handleDownloadCSV = (segmentName) => {
        if (!segments || !segments[segmentName]) return;
        exportToCSV(segments[segmentName], segmentName);
        logger.success(`${segmentName} CSV ë‹¤ìš´ë¡œë“œ`);
      };

      const handleUpdateProperties = async (segmentName) => {
        const propertyName = propertyNames[segmentName];
        const propertyValue = propertyValues[segmentName];
        
        if (!propertyName || !propertyValue) {
          logger.error('ì†ì„±ëª…ê³¼ ì†ì„±ê°’ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”');
          alert('âŒ ì…ë ¥ ì˜¤ë¥˜\n\nì†ì„±ëª…ê³¼ ì†ì„±ê°’ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }
        
        const users = segments[segmentName];
        const confirmMessage = `âš ï¸ ìœ ì € ì†ì„± ì—…ë°ì´íŠ¸
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š ì„¸ê·¸ë¨¼íŠ¸: ${segmentName}
ğŸ‘¥ ëŒ€ìƒ ì¸ì›: ${users.length.toLocaleString()}ëª…
ğŸ·ï¸ ì†ì„±ëª…: ${propertyName}
ğŸ“ ì†ì„±ê°’: ${propertyValue}

âš ï¸ ì´ ì‘ì—…ì€ Notiflyì— ë°ì´í„°ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.

ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;

        if (!confirm(confirmMessage)) return;

        try {
          const userIds = users.map(u => u.user_id);
          const result = await updateUserPropertiesBatch(propertyName, propertyValue, userIds);
          logger.success(`âœ“ ì†ì„± ì—…ë°ì´íŠ¸ ì™„ë£Œ (${result.totalUpdated}ëª…)`);
          alert(`âœ… ì„±ê³µ!\n\nì—…ë°ì´íŠ¸ ì™„ë£Œ: ${result.totalUpdated.toLocaleString()}/${result.totalUsers.toLocaleString()}ëª…`);
        } catch (error) {
          logger.error(`ì†ì„± ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ${error.message}`);
          alert(`âŒ ì˜¤ë¥˜ ë°œìƒ\n\n${error.message}`);
        }
      };

      const handleSendCampaign = async (segmentName) => {
        const campaignId = campaignIds[segmentName];
        if (!segments || !segments[segmentName] || !campaignId) {
          logger.error('ìº í˜ì¸ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
          return;
        }

        const users = segments[segmentName].filter(u => u.í‘¸ì‹œê°€ëŠ¥);
        
        if (users.length === 0) {
          logger.error('ë°œì†¡ ê°€ëŠ¥í•œ ìœ ì €ê°€ ì—†ìŠµë‹ˆë‹¤');
          alert('âŒ ë°œì†¡ ë¶ˆê°€\n\ní‘¸ì‹œ ë™ì˜í•œ ìœ ì €ê°€ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }

        const confirmMessage = `ğŸš¨ ìº í˜ì¸ ì „ì²´ ë°œì†¡
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š ì„¸ê·¸ë¨¼íŠ¸: ${segmentName}
ğŸ“¨ ìº í˜ì¸ ID: ${campaignId}
ğŸ‘¥ ë°œì†¡ ëŒ€ìƒ: ${users.length.toLocaleString()}ëª…

âš ï¸ ì‹¤ì œ ë°œì†¡ì´ ì§„í–‰ë©ë‹ˆë‹¤!

ì •ë§ ë°œì†¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;

        if (!confirm(confirmMessage)) return;
        if (!confirm(`âš ï¸ ìµœì¢… í™•ì¸\n\n${users.length.toLocaleString()}ëª…ì—ê²Œ ì¦‰ì‹œ ë°œì†¡ë©ë‹ˆë‹¤.\nì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;

        try {
          const result = await sendCampaignBatch(campaignId, users);
          logger.success(`âœ“ ìº í˜ì¸ ë°œì†¡ ì™„ë£Œ (${result.totalSent}ëª…)`);
          alert(`âœ… ë°œì†¡ ì™„ë£Œ!\n\nì„±ê³µ: ${result.totalSent.toLocaleString()}/${result.totalUsers.toLocaleString()}ëª…`);
        } catch (error) {
          logger.error(`ìº í˜ì¸ ë°œì†¡ ì‹¤íŒ¨: ${error.message}`);
          alert(`âŒ ì˜¤ë¥˜ ë°œìƒ\n\n${error.message}`);
        }
      };

      const handleSendTest = async (segmentName) => {
        const campaignId = campaignIds[segmentName];
        const testIds = testUserIds[segmentName];
        
        if (!campaignId || !testIds) {
          logger.error('ìº í˜ì¸ IDì™€ í…ŒìŠ¤íŠ¸ User IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
          alert('âŒ ì…ë ¥ ì˜¤ë¥˜');
          return;
        }

        try {
          const testUsers = await sendTestCampaign(campaignId, testIds, allUsers);
          const testUserNames = testUsers.map(u => u.nickname || `ìœ ì €${u.user_id}`).join(', ');
          alert(`âœ… í…ŒìŠ¤íŠ¸ ë°œì†¡ ì™„ë£Œ!\n\në°œì†¡: ${testUsers.length}ëª…\nëŒ€ìƒ: ${testUserNames}`);
        } catch (error) {
          logger.error(`í…ŒìŠ¤íŠ¸ ë°œì†¡ ì‹¤íŒ¨: ${error.message}`);
          alert(`âŒ ì˜¤ë¥˜ ë°œìƒ\n\n${error.message}`);
        }
      };

      const handleSaveCustomSegment = async () => {
        if (!newSegment.name) {
          logger.error('ì„¸ê·¸ë¨¼íŠ¸ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
          alert('âŒ ì…ë ¥ ì˜¤ë¥˜\n\nì„¸ê·¸ë¨¼íŠ¸ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }

        try {
          await saveCustomSegment(newSegment.name, newSegment.conditions);
          logger.success(`ì»¤ìŠ¤í…€ ì„¸ê·¸ë¨¼íŠ¸ "${newSegment.name}" ì €ì¥ ì™„ë£Œ`);
          
          const data = await fetchCustomSegments();
          setCustomSegs(data || []);
          
          setNewSegment(JSON.parse(JSON.stringify(CUSTOM_SEGMENT_TEMPLATE)));
          alert(`âœ… ì €ì¥ ì™„ë£Œ!\n\nì„¸ê·¸ë¨¼íŠ¸: ${newSegment.name}`);
        } catch (error) {
          logger.error(`ì„¸ê·¸ë¨¼íŠ¸ ì €ì¥ ì‹¤íŒ¨: ${error.message}`);
          alert(`âŒ ì˜¤ë¥˜ ë°œìƒ\n\n${error.message}`);
        }
      };

      const handleDeleteCustomSegment = async (segmentName) => {
        if (!confirm(`"${segmentName}" ì„¸ê·¸ë¨¼íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;

        try {
          await deleteCustomSegment(segmentName);
          logger.success(`ì„¸ê·¸ë¨¼íŠ¸ "${segmentName}" ì‚­ì œ ì™„ë£Œ`);
          
          const data = await fetchCustomSegments();
          setCustomSegs(data || []);
          alert('âœ… ì‚­ì œ ì™„ë£Œ!');
        } catch (error) {
          logger.error(`ì„¸ê·¸ë¨¼íŠ¸ ì‚­ì œ ì‹¤íŒ¨: ${error.message}`);
          alert(`âŒ ì˜¤ë¥˜ ë°œìƒ\n\n${error.message}`);
        }
      };

      const handleRefresh = async () => {
        try {
          const stats = await fetchDatabaseStats();
          setDbStats(stats);
          logger.success('DB í†µê³„ ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ');
        } catch (error) {
          logger.error(`ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨: ${error.message}`);
        }
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-orange-50 to-orange-100 p-6">
          <div className="max-w-7xl mx-auto">
            {/* í—¤ë” */}
            <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
              <h1 className="text-3xl font-bold text-orange-600 mb-2">ğŸ›’ íë§ˆì¼“ CRM ì„¸ê·¸ë¨¼íŠ¸ ëŒ€ì‹œë³´ë“œ</h1>
              <p className="text-gray-600">
                Supabase + Vercel ì—°ë™ | ì‹¤ì‹œê°„ ë™ê¸°í™” | {dbStats.users.toLocaleString()}ëª… ê´€ë¦¬ì¤‘
              </p>
            </div>

            {/* í†µê³„ íŒ¨ë„ */}
            <div className="grid grid-cols-3 gap-4 mb-6">
              <div className="bg-white rounded-lg shadow p-4">
                <div className="text-sm text-gray-500 mb-1">ğŸ“Š DB: Users</div>
                <div className="text-2xl font-bold text-orange-600">{dbStats.users.toLocaleString()}ëª…</div>
              </div>
              <div className="bg-white rounded-lg shadow p-4">
                <div className="text-sm text-gray-500 mb-1">ğŸ›ï¸ DB: Orders</div>
                <div className="text-2xl font-bold text-blue-600">{dbStats.orders.toLocaleString()}ê±´</div>
              </div>
              <div className="bg-white rounded-lg shadow p-4">
                <div className="text-sm text-gray-500 mb-1">ğŸŸï¸ DB: Coupons</div>
                <div className="text-2xl font-bold text-green-600">{dbStats.coupons.toLocaleString()}ê±´</div>
              </div>
            </div>

            {/* ì•¡ì…˜ ë²„íŠ¼ */}
            <div className="flex gap-4 mb-6">
              <button
                onClick={analyzeAndClassify}
                disabled={loading || dbStats.users === 0}
                className="flex-1 bg-orange-500 text-white py-3 rounded-lg font-bold hover:bg-orange-600 disabled:bg-gray-300 transition"
              >
                {loading ? 'â³ ë¶„ì„ ì¤‘... (30-60ì´ˆ ì†Œìš”)' : 'ğŸ¯ ì„¸ê·¸ë¨¼íŠ¸ ë¶„ì„ ì‹œì‘'}
              </button>

              <button
                onClick={handleRefresh}
                className="bg-blue-500 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-600 transition"
              >
                ğŸ”„ ìƒˆë¡œê³ ì¹¨
              </button>
            </div>

            {/* íƒ­ ë° ì„¸ê·¸ë¨¼íŠ¸ í‘œì‹œ */}
            {segments && (
              <>
                <div className="bg-white rounded-lg shadow mb-6">
                  <div className="flex border-b">
                    <button
                      onClick={() => setActiveTab('predefined')}
                      className={`flex-1 py-3 font-bold ${activeTab === 'predefined' ? 'bg-orange-500 text-white' : 'text-gray-600 hover:bg-gray-50'}`}
                    >
                      ğŸ“Š ê¸°ë³¸ ì„¸ê·¸ë¨¼íŠ¸
                    </button>
                    <button
                      onClick={() => setActiveTab('custom')}
                      className={`flex-1 py-3 font-bold ${activeTab === 'custom' ? 'bg-orange-500 text-white' : 'text-gray-600 hover:bg-gray-50'}`}
                    >
                      âš™ï¸ ì»¤ìŠ¤í…€ ì„¸ê·¸ë¨¼íŠ¸ ({customSegs.length})
                    </button>
                  </div>

                  {activeTab === 'predefined' && (
                    <div className="p-6">
                      <div className="flex gap-2 mb-4 flex-wrap">
                        {Object.keys(PREDEFINED_SEGMENTS).map(category => (
                          <button
                            key={category}
                            onClick={() => setActiveCategory(category)}
                            className={`px-4 py-2 rounded-lg font-medium ${
                              activeCategory === category
                                ? 'bg-orange-500 text-white'
                                : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                            }`}
                          >
                            {category}
                          </button>
                        ))}
                      </div>

                      <div className="space-y-4">
                        {PREDEFINED_SEGMENTS[activeCategory].map(seg => 
                          <SegmentCard
                            key={seg.name}
                            name={seg.name}
                            users={segments[seg.name]}
                            info={seg}
                            onDownloadCSV={handleDownloadCSV}
                            onUpdateProperties={handleUpdateProperties}
                            onSendCampaign={handleSendCampaign}
                            onSendTest={handleSendTest}
                            propertyName={propertyNames[seg.name]}
                            propertyValue={propertyValues[seg.name]}
                            campaignId={campaignIds[seg.name]}
                            testUserIds={testUserIds[seg.name]}
                            onPropertyNameChange={(name, value) => setPropertyNames({...propertyNames, [name]: value})}
                            onPropertyValueChange={(name, value) => setPropertyValues({...propertyValues, [name]: value})}
                            onCampaignIdChange={(name, value) => setCampaignIds({...campaignIds, [name]: value})}
                            onTestUserIdsChange={(name, value) => setTestUserIds({...testUserIds, [name]: value})}
                          />
                        )}
                      </div>
                    </div>
                  )}

                  {activeTab === 'custom' && (
                    <div className="p-6">
                      <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                        <h3 className="font-bold text-blue-900 mb-3">â• ìƒˆ ì»¤ìŠ¤í…€ ì„¸ê·¸ë¨¼íŠ¸ ë§Œë“¤ê¸°</h3>
                        
                        <div className="grid grid-cols-2 gap-4 mb-4">
                          <div className="col-span-2">
                            <label className="block text-sm font-medium mb-1">ì„¸ê·¸ë¨¼íŠ¸ ì´ë¦„</label>
                            <input
                              type="text"
                              value={newSegment.name}
                              onChange={(e) => setNewSegment({...newSegment, name: e.target.value})}
                              placeholder="ì˜ˆ: 30ì¼_ë¯¸êµ¬ë§¤_ì¿ í°ë³´ìœ ì"
                              className="w-full border rounded px-3 py-2"
                            />
                          </div>

                          <div>
                            <label className="block text-sm font-medium mb-1">ê°€ì…ì¼ (ì¼)</label>
                            <div className="flex gap-2">
                              <input
                                type="number"
                                placeholder="ìµœì†Œ"
                                value={newSegment.conditions.signupDaysMin}
                                onChange={(e) => setNewSegment({...newSegment, conditions: {...newSegment.conditions, signupDaysMin: e.target.value}})}
                                className="w-full border rounded px-2 py-1 text-sm"
                              />
                              <input
                                type="number"
                                placeholder="ìµœëŒ€"
                                value={newSegment.conditions.signupDaysMax}
                                onChange={(e) => setNewSegment({...newSegment, conditions: {...newSegment.conditions, signupDaysMax: e.target.value}})}
                                className="w-full border rounded px-2 py-1 text-sm"
                              />
                            </div>
                          </div>

                          <div>
                            <label className="block text-sm font-medium mb-1">ëˆ„ì êµ¬ë§¤ì•¡</label>
                            <div className="flex gap-2">
                              <input
                                type="number"
                                placeholder="ìµœì†Œ"
                                value={newSegment.conditions.totalAmountMin}
                                onChange={(e) => setNewSegment({...newSegment, conditions: {...newSegment.conditions, totalAmountMin: e.target.value}})}
                                className="w-full border rounded px-2 py-1 text-sm"
                              />
                              <input
                                type="number"
                                placeholder="ìµœëŒ€"
                                value={newSegment.conditions.totalAmountMax}
                                onChange={(e) => setNewSegment({...newSegment, conditions: {...newSegment.conditions, totalAmountMax: e.target.value}})}
                                className="w-full border rounded px-2 py-1 text-sm"
                              />
                            </div>
                          </div>

                          <div>
                            <label className="block text-sm font-medium mb-1">ì£¼ë¬¸íšŸìˆ˜</label>
                            <div className="flex gap-2">
                              <input
                                type="number"
                                placeholder="ìµœì†Œ"
                                value={newSegment.conditions.orderCountMin}
                                onChange={(e) => setNewSegment({...newSegment, conditions: {...newSeg
